# 倪師斗數 - 企業決策支援系統設計文件

> 建立日期：2026-02-02
> 基於倪海廈智慧，應用於命理、風水、易經八卦

## 一、專案概述

### 目標用戶
私人企業老闆，用於：
- 識人（人事招募決策）
- 團隊配置
- 合夥評估
- 重大決策（卜卦）
- 風水調整（辦公室/住家）
- 家庭分析

### 核心價值
輸入公司/家庭成員的生辰資料，系統自動排盤並結合倪海廈的命理智慧，產生分析報告與建議。

---

## 二、系統架構

```
┌─────────────────────────────────────────────────────────┐
│                      Frontend                            │
│                 Next.js + React                          │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐    │
│  │ 命盤視覺 │  │ 風水圖  │  │ 關係圖  │  │ AI對話  │    │
│  └─────────┘  └─────────┘  └─────────┘  └─────────┘    │
└─────────────────────────────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────┐
│                    Backend (FastAPI)                     │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐    │
│  │ 排盤服務 │  │ 分析引擎 │  │ AI服務  │  │ 風水引擎│    │
│  │ (iztro) │  │         │  │(LangChain)│ │         │    │
│  └─────────┘  └─────────┘  └─────────┘  └─────────┘    │
└─────────────────────────────────────────────────────────┘
                           │
          ┌────────────────┼────────────────┐
          ▼                ▼                ▼
   ┌──────────┐     ┌──────────┐     ┌──────────┐
   │PostgreSQL│     │ ChromaDB │     │  Redis   │
   │ 結構化   │     │ 向量知識 │     │  快取    │
   │ 規則/人員│     │ 倪師智慧 │     │          │
   └──────────┘     └──────────┘     └──────────┘
```

### 技術棧
- **Frontend**: Next.js + React + TailwindCSS
- **Backend**: Python FastAPI
- **AI**: OpenAI GPT-4 + LangChain
- **Database**: PostgreSQL（結構化）+ ChromaDB（向量）
- **排盤引擎**: iztro（JavaScript 開源庫）
- **快取**: Redis

---

## 三、知識庫結構

### 3.1 結構化規則（PostgreSQL / JSON）

#### stars（星曜表）
| 欄位 | 說明 |
|------|------|
| id | 星曜 ID |
| name | 星曜名稱 |
| type | 北斗/南斗/六煞/輔星 |
| nature | 星性（帝星、財星、桃花星...） |
| represents | 代表（文官/武官/正財/橫財...） |
| appearance | 外貌特徵 |

#### palaces（宮位表）
| 欄位 | 說明 |
|------|------|
| id | 宮位 ID |
| name | 宮位名稱 |
| meaning | 宮位意義 |
| body_part | 對應身體部位 |
| face_part | 對應面相部位 |

#### brightness（星曜亮度表）
| 欄位 | 說明 |
|------|------|
| star_id | 星曜 ID |
| palace_branch | 地支 |
| level | 廟/旺/利/陷 |

#### patterns（格局表）
| 欄位 | 說明 |
|------|------|
| name | 格局名稱 |
| conditions | 成格條件（JSON） |
| meaning | 格局含義 |
| gender_effect | 男命/女命差異 |

#### star_combinations（星曜組合表）
| 欄位 | 說明 |
|------|------|
| stars | 星曜組合 |
| palace | 所在宮位 |
| effect | 效果 |
| remedy | 化解方法 |

#### fengshui_rules（風水規則表）
| 欄位 | 說明 |
|------|------|
| position | 方位 |
| element | 元素（廚房、廁所...） |
| effect | 影響 |
| remedy | 化解方法 |

### 3.2 向量知識庫（ChromaDB）

| Collection | 內容 |
|------------|------|
| tianji_notes | 天機道筆記原文 |
| renjian_notes | 人間道筆記 |
| dimai_notes | 地脈道筆記 |
| yijing_wisdom | 易經八卦解說 |
| face_reading | 面相細節 |
| case_studies | 倪師批命案例 |

---

## 四、前端介面

### 4.1 主要頁面

1. **儀表板首頁**
   - 公司/家庭總覽
   - 近期流年提醒
   - 快速操作

2. **人員管理**
   - 新增成員（姓名、生辰、性別、角色）
   - 成員列表（分組顯示）
   - 批量匯入（Excel）

3. **命盤分析**
   - 視覺化命盤（十二宮）
   - 特殊格局顯示
   - 基本分析 + 大運流年
   - AI 對話追問
   - PDF 報告匯出

4. **關係分析**
   - 兩人合盤
   - 團隊分析
   - 八字合婚

5. **風水分析**
   - 格局輸入
   - 問題診斷
   - 床位建議
   - 化解方案

6. **卜卦決策**
   - 六壬速斷
   - 易經卜卦
   - 歷史記錄

### 4.2 命盤視覺化需求

- 顯示完整出生時間（年月日時分）
- 顯示農曆、節氣、生肖、星座
- 顯示所有符合的特殊格局
- 點擊宮位展開詳細解說

---

## 五、分析引擎邏輯

### 5.1 個人命盤分析流程

1. **Step 1：排盤（iztro）**
   - 計算十二宮位置
   - 安主星、輔星、煞星
   - 計算四化、星曜亮度
   - 計算大運、流年、流月

2. **Step 2：格局掃描**
   - 掃描吉格/凶格條件
   - 判斷特殊組合
   - 計算格局強度

3. **Step 3：逐宮分析**
   - 結合結構化規則
   - 向量搜尋補充細節

4. **Step 4：三方四正分析**
   - 整體命格判斷
   - 風險提示

5. **Step 5：大運流年分析**
   - 當前運勢
   - 大限預警
   - 婚姻時機

6. **Step 6：AI 整合報告**
   - 倪師風格解讀
   - 結構化報告輸出

### 5.2 識人應用輸出

- 適合度分析（評分）
- 風險提示
- 流年提醒
- 職位建議

### 5.3 關係分析輸出

- 八字配對結果
- 合夥風險評估
- 建議（僱傭/合夥/避免）

---

## 六、開發階段

### Phase 1：知識庫建立
- [ ] 處理倪師資料（PDF/DOC → 文字提取）
- [ ] 建立結構化規則表
- [ ] 建立向量知識庫
- [ ] 測試知識查詢準確度

### Phase 2：排盤引擎整合
- [ ] 整合 iztro 排盤庫
- [ ] 建立格局自動判斷邏輯
- [ ] 建立三方四正分析邏輯
- [ ] 測試排盤結果正確性

### Phase 3：後端 API
- [ ] FastAPI 專案架構
- [ ] 人員 CRUD API
- [ ] 命盤分析 API
- [ ] 關係分析 API
- [ ] 風水分析 API
- [ ] 卜卦 API
- [ ] AI 對話 API

### Phase 4：前端儀表板
- [ ] Next.js 專案架構
- [ ] 命盤視覺化組件
- [ ] 各功能頁面
- [ ] AI 對話介面
- [ ] PDF 報告匯出

### Phase 5：測試與部署
- [ ] 真實命盤測試
- [ ] 部署到雲端
- [ ] 上線使用

---

## 七、資料夾結構

```
倪師斗數/
├── backend/                    # Python FastAPI 後端
│   ├── api/                   # API 路由
│   ├── models/                # 資料模型
│   ├── services/              # 業務邏輯
│   └── rules/                 # 結構化規則（JSON）
├── frontend/                   # Next.js 前端
│   ├── app/                   # 頁面
│   ├── components/            # 組件
│   └── lib/                   # 工具函數
├── knowledge/                  # 知識庫
│   ├── raw/                   # 原始資料
│   ├── processed/             # 處理後資料
│   └── vectors/               # 向量資料
├── scripts/                    # 工具腳本
├── data/                       # 使用者資料
└── docs/                       # 文件
```

---

## 八、後續擴展

- 手機 APP 版本
- 多語言支援
- 更多命理體系（八字、六爻）
- AI 自動學習新案例
